if("undefined"!==typeof exports)var Space=require("space");function Element(a,b){this.tag=a;this.attrs=b||{};this.content="";return this}Element.prototype.addClass=function(a){this.attrs["class"]=this.attrs["class"]?this.attrs["class"]+(" "+a):a};Element.prototype.append=function(a){this.content+=a};Element.prototype.attr=function(a,b){this.attrs[a]=b};Element.prototype.html=function(a){this.content+=a};
Element.prototype.toHtml=function(){var a="<"+this.tag,b;for(b in this.attrs)this.attrs.hasOwnProperty(b)&&(a+=" "+b+'="'+this.attrs[b]+'"');"meta"===this.tag?a+=' content="'+this.content+'">':(a+=">"+this.content,a+="</"+this.tag+">");return a};function Scrap(a,b){this.path=a;this.id=a.split(/ /g).pop();this.clear();b instanceof Space||(b=new Space(b));this.patch(b);var c=this.get("scraps");c instanceof Space&&c.each(function(b,e){c.set(b,new Scrap(a+" "+b,e))});return this}
Scrap.styleToCss=function(a,b){var c=a+" {\n",d;for(d in b)b.hasOwnProperty(d)&&(c+="  "+d+" : "+b[d].toString().replace(/\;$/,"")+";\n");return c+"}\n"};Scrap.styleToInline=function(a){var b="",c;for(c in a)a.hasOwnProperty(c)&&(b+=c+": "+a[c].toString().replace(/\;$/,"")+"; ");return b};Scrap.prototype=new Space;Scrap.prototype.clone=function(a){return new Scrap(a,this)};Scrap.prototype.selector=function(){return"#"+this.path.replace(/ /g," #")};
Scrap.prototype.setChildren=function(a){var b=this.get("scraps");if(!b)return this;var c=this;b.each(function(b,e){c.div.html(e.toHtml(a))});return this};Scrap.prototype.setContent=function(){this.get("content")&&this.div.html(this.get("content"));var a=this.get("styles");if(a&&a instanceof Space){var b=this.div;a.each(function(a,d){b.html(Scrap.styleToCss(a,d.toObject()))})}return this};Scrap.prototype.setTag=function(){tag=this.get("tag")?this.get("tag"):"div";this.div=new Element(tag)};
Scrap.prototype.setProperties=function(){this.each(function(a){if(a.match(/^(scraps|content|tag|on.*|style)$/))return!0;this.setProperty(a)})};Scrap.prototype.setProperty=function(a){this.get(a)&&this.div.attr(a,this.get(a))};Scrap.prototype.setHandlers=function(){this.each(function(a,b){if(!a.match(/^on.*$/))return!0;this.div.attr(a,b)})};
Scrap.prototype.setStyle=function(){if(!this.get("style"))return null;if(!(this.get("style")instanceof Space))return this.div.attr("style",this.get("style"));this.div.attr("style",Scrap.styleToInline(this.get("style").toObject()))};Scrap.prototype.toHtml=function(a){this.setTag();this.div.attr("id",this.id);this.setProperties();this.setContent();this.setChildren(a);this.setStyle();this.setHandlers();return a?a.call(this):this.div.toHtml()};
function Page(a){this.clear();a&&this.patch(a);this.loadScraps();return this}Page.prototype=new Space;Page.prototype.clone=function(){return new Page(this.toObject())};Page.prototype.loadScraps=function(){var a=this;this.each(function(b,c){a.set(b,new Scrap(b,c))})};Page.prototype.toHtml=function(a){var b="<!doctype html>\n<html>";this.each(function(c,d){b+="\n  "+d.toHtml(a)});return b+="\n</html>"};"undefined"!==typeof exports&&(module.exports=Page);
